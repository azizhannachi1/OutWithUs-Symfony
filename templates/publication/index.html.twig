{% extends 'base2.html.twig' %}

{% block title %}
<title>OutWithUs- Liste de nos publications</title>
{% endblock %}
{% block body %}
 <!-- ======= Breadcrumbs ======= -->
 <section id="breadcrumbs" class="breadcrumbs">
    <div class="container">

      <div class="d-flex justify-content-between align-items-center">
        <h2>Publictions</h2>
        <ol>
          <li><a href="index.html">Home</a></li>
        </ol>
      </div>

    </div>
  </section>
  <!-- End Breadcrumbs -->

   <!-- ======= Blog Section ======= -->
   <section id="blog" class="blog">
    <div class="container" data-aos="fade-up">

      <div class="row">

        <div class="col-lg-8 entries">


            {% for p in publication %}


          <article class="entry">

            <div class="entry-img">
                {% if p.image|length > 0 %}
                        <img src="{{ asset('uploads/'~ p.image ) }}" alt="" class="img-fluid">
                        {% else %}
                        <img src="{{ asset('uploads/'~ "404.png" ) }}" alt="" class="img-fluid">
                        {% endif %}   
              
            </div>

            <h2 class="entry-title">
              <a href="{{ path('details_publication', {id: p.id}) }}"> {{ p.titre }}</a>
            </h2>

            <div class="entry-meta">
              <ul>
                <li class="d-flex align-items-center"><i class="bi bi-person"></i> <a href="#">{{ p.user.nom }} {{ p.user.prenom }}</a>
                
                    
                </li>
                <li class="d-flex align-items-center"><i class="bi bi-clock"></i> <a href="blog-single.html"><time datetime="2020-01-01">{{p.date|date("d/m/Y") }}</time></a></li>
                <li class="d-flex align-items-center"><i class="bi bi-chat-dots"></i> <a href="blog-single.html">{{ p.comments | length }}</a>
                    <a href="{{ path('publication_like', {'id': p.id}) }}" class="btn btn-link js-like">
                        {% if p.isLikeByUserId(4) %}
                        <i class="bi bi-hand-thumbs-up-fill"></i>
                         {% else %}                            
                         <i class="bi bi-hand-thumbs-up"></i>
                         {% endif %}
                         <span class="js-likes">{{ p.likes | length }}</span>
                         <span class="js-label">J'aime</span>
                         
                     </a> 
</li>
              </ul>
            </div>

            <div class="entry-content">
              <p>
                {{ p.text|striptags|u.truncate(20, '...') }}
              </p>
              <div class="read-more">
                <a href="{{ path('details_publication', {id: p.id}) }}">Lire la suite</a>
              </div>
            </div>

          </article>
          <!-- End blog entry -->
          {% endfor %}
          <div class="blog-pagination">
            <ul class="justify-content-center">
          {{ knp_pagination_render(publication) }}
        </ul>
        </div>
           
           
           
          

        </div><!-- End blog entries list -->


      </div>

    </div>
  </section><!-- End Blog Section -->

  <script src="https://unpkg.com/axios@0.26.1/dist/axios.min.js"></script>
<script>
    function onClickBtnLike(event){
      event.preventDefault();

      const url=this.href;
      const spanCount=this.querySelector('span.js-likes');
      const icone= this.querySelector('i');

      axios.get(url).then(function (response){
          spanCount.textContent=response.data.likes;
          if (icone.classList.contains('bi-hand-thumbs-up-fill'))
              icone.classList.replace('bi-hand-thumbs-up-fill','bi-hand-thumbs-up');
          else
              icone.classList.replace('bi-hand-thumbs-up','bi-hand-thumbs-up-fill');
      })
    }

    document.querySelectorAll('a.js-like').forEach(function (link){
        link.addEventListener('click',onClickBtnLike);
    })
</script>
{% endblock %}
